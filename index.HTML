<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>B√© ƒêi Si√™u Th·ªã - Educational Game</title>
    <style>
        /* --- 1. RESET & LAYOUT C∆† B·∫¢N --- */
        * { box-sizing: border-box; user-select: none; -webkit-user-select: none; }
        body {
            margin: 0; padding: 0;
            background-color: #2d3436; /* M√†u n·ªÅn ƒëen/x√°m bao quanh khung game */
            height: 100vh; width: 100vw;
            display: flex; justify-content: center; align-items: center;
            overflow: hidden;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }

        /* --- 2. KHUNG GAME CHU·∫®N T·ª∂ L·ªÜ 16:9 --- */
        /* Khung n√†y quy ƒë·ªãnh t·ª∑ l·ªá cho TO√ÄN B·ªò game, bao g·ªìm c·∫£ ·∫£nh n·ªÅn b·∫Øt ƒë·∫ßu */
        #game-stage {
            position: relative;
            width: 100%;
            max-width: 177.78vh; /* Gi·ªõi h·∫°n chi·ªÅu r·ªông theo t·ª∑ l·ªá 16/9 c·ªßa chi·ªÅu cao */
            aspect-ratio: 16/9;  /* Bu·ªôc khung lu√¥n gi·ªØ t·ª∑ l·ªá 16:9 */
            max-height: 100vh;
            background-image: url('st.png');
            background-size: 100% 100%; /* ·∫¢nh s·∫Ω lu√¥n v·ª´a kh√≠t khung 16:9 n√†y */
            background-position: center;
            background-repeat: no-repeat;
            box-shadow: 0 0 20px rgba(0,0,0,0.5);
            overflow: hidden;
        }

        /* L·ªõp ph·ªß m√†n h√¨nh */
        .overlay {
            position: absolute; top: 0; left: 0; right: 0; bottom: 0;
            background: rgba(255, 255, 255, 0.3); z-index: 1; pointer-events: none;
        }

        /* --- 3. M√ÄN H√åNH B·∫ÆT ƒê·∫¶U (INTRO) --- */
        #start-screen {
            position: absolute; top: 0; left: 0; width: 100%; height: 100%;
            /* C·∫¨P NH·∫¨T: S·ª≠ d·ª•ng file nen.png */
            background-image: url('nen.png'); 
            /* K√≠ch th∆∞·ªõc 100% 100% s·∫Ω √©p ·∫£nh v·ª´a kh√≠t v·ªõi khung ch·ª©a 16:9 b√™n ngo√†i */
            background-size: 100% 100%; 
            background-position: center;
            z-index: 999;
            display: flex; justify-content: center; align-items: center;
            transition: opacity 0.5s ease;
        }

        /* --- 4. C√ÅC M√ÄN H√åNH C√ÇU H·ªéI (SCREENS) --- */
        .screen {
            display: none; flex-direction: column;
            width: 100%; height: 100%; position: relative; z-index: 2;
        }
        .active-screen { display: flex; animation: fadeIn 0.5s; }

        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }

        /* Ti√™u ƒë·ªÅ c√¢u h·ªèi */
        .question-box {
            height: 15%; /* Chi·∫øm 15% chi·ªÅu cao khung */
            display: flex; justify-content: center; align-items: center;
        }
        .question-title {
            text-align: center; font-size: clamp(16px, 2.5vh, 24px); /* Ch·ªØ t·ª± co gi√£n */
            color: #d63031; font-weight: bold;
            background: rgba(255,255,255,0.95); padding: 1vh 2vw;
            border-radius: 15px; box-shadow: 0 4px 8px rgba(0,0,0,0.2);
            border: 2px solid #fab1a0; width: 80%;
        }

        /* Khu v·ª±c v·∫≠t ph·∫©m (Items) */
        .items-area {
            flex: 1; display: flex; justify-content: center; align-items: center;
            flex-wrap: wrap; gap: 1.5vh; padding: 0 2vw; align-content: center;
        }

        .food-item {
            width: 11vh; height: 11vh; /* K√≠ch th∆∞·ªõc d·ª±a theo chi·ªÅu cao m√†n h√¨nh */
            background: white; border-radius: 1vh; padding: 0.5vh;
            cursor: grab; transition: transform 0.2s;
            filter: drop-shadow(0 2px 4px rgba(0,0,0,0.2));
            display: flex; justify-content: center; align-items: center;
            z-index: 100; /* ƒê·∫£m b·∫£o n·ªïi l√™n tr√™n */
        }
        .food-item:active { cursor: grabbing; transform: scale(1.1); }
        .food-item img { width: 100%; height: 100%; object-fit: contain; pointer-events: none; }

        /* Ch·∫ø ƒë·ªô ƒë√°p √°n ch·ªØ (C√¢u 5,6) */
        .items-area.text-mode .food-item { width: 18vh; height: 12vh; }

        /* Khu v·ª±c Gi·ªè */
        .basket-area {
            height: 25%; /* Chi·∫øm 25% chi·ªÅu cao d∆∞·ªõi c√πng */
            display: flex; justify-content: center; align-items: flex-end;
            padding-bottom: 2vh; gap: 2vw;
        }

        .basket {
            width: 18%; height: 100%;
            background-size: contain; background-repeat: no-repeat; background-position: bottom center;
            transition: transform 0.2s; position: relative;
        }
        .basket.hovered { transform: scale(1.1); filter: drop-shadow(0 0 10px #ffeaa7); }
        
        .basket.big-basket { width: 35%; background-image: url('gio.png'); }
        .b-vitamin { background-image: url('A.png'); }
        .b-fat { background-image: url('B.png'); }
        .b-carb { background-image: url('C.png'); }
        .b-protein { background-image: url('D.png'); }

        /* --- 5. UI BUTTONS --- */
        .controls { position: absolute; bottom: 2vh; right: 2vh; display: flex; gap: 1vw; z-index: 10; }
        .btn {
            padding: 1vh 2vw; font-size: clamp(14px, 2vh, 20px); font-weight: bold;
            border: none; border-radius: 50px; cursor: pointer;
            font-family: 'Comic Sans MS', cursive, sans-serif;
            box-shadow: 0 4px 6px rgba(0,0,0,0.3); outline: none;
        }
        .btn:active { transform: translateY(2px); }
        
        .btn-start {
            /* CSS cho n√∫t b·∫Øt ƒë·∫ßu n·∫±m gi·ªØa m√†n h√¨nh intro */
            padding: 2vh 4vw; font-size: clamp(20px, 4vh, 40px);
            background: #00b894; color: white; border: 4px solid white;
            animation: pulse 1.5s infinite;
            box-shadow: 0 0 20px rgba(0,184,148,0.5);
        }
        .btn-replay { background-color: #ff7675; color: white; }
        .btn-next { background-color: #0984e3; color: white; display: none; animation: pulse 1s infinite; }

        /* --- 6. HI·ªÜU ·ª®NG & M√ÄN H√åNH TH·∫ÆNG --- */
        .hidden { visibility: hidden; opacity: 0; pointer-events: none; }
        @keyframes pulse { 0% { transform: scale(1); } 50% { transform: scale(1.05); } 100% { transform: scale(1); } }
        .shake { animation: shake 0.4s cubic-bezier(.36,.07,.19,.97) both; }
        @keyframes shake { 10%, 90% { transform: translate3d(-2px, 0, 0); } 20%, 80% { transform: translate3d(4px, 0, 0); } 30%, 50%, 70% { transform: translate3d(-8px, 0, 0); } 40%, 60% { transform: translate3d(8px, 0, 0); } }

        #victory-screen {
            display: none; flex-direction: column; align-items: center; justify-content: center;
            width: 100%; height: 100%; position: absolute; top: 0; left: 0;
            background: rgba(255,255,255,0.98); z-index: 1000;
        }

        /* --- 7. MOBILE PORTRAIT WARNING --- */
        #rotate-msg {
            display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: #2d3436; color: white; z-index: 10000;
            flex-direction: column; align-items: center; justify-content: center; text-align: center;
        }
        @media only screen and (orientation: portrait) {
            #rotate-msg { display: flex; }
        }
    </style>
</head>
<body>

    <div id="rotate-msg">
        <div style="font-size: 50px;">üì≤ ‚ü≤</div>
        <p>B√© h√£y xoay ngang ƒëi·ªán tho·∫°i ƒë·ªÉ ch∆°i nh√©!</p>
    </div>

    <div id="game-stage">
        
        <div class="overlay"></div>
        
        <audio id="bg-music" loop><source src="nen.mp3" type="audio/mpeg"></audio>
        <audio id="sound-wrong"><source src="sai.mp3" type="audio/mpeg"></audio>
        <audio id="sound-correct"><source src="dung.mp3" type="audio/mpeg"></audio>

        <div id="start-screen">
            <button class="btn btn-start" onclick="GameApp.start()">V√ÄO L·ªöP H·ªåC üè´</button>
        </div>

        <div class="screen" id="q1">
            <div class="question-box"><div class="question-title">C√¢u 1: B√© h√£y ch·ªçn c√°c th·ª±c ph·∫©m thu·ªôc nh√≥m <b>B·ªòT ƒê∆Ø·ªúNG</b>?</div></div>
            <div class="items-area">
                <div class="food-item" draggable="true" id="q1-banhmi" data-target="carb"><img src="banhmi.png" alt="B√°nh m√¨"></div>
                <div class="food-item" draggable="true" id="q1-khoai" data-target="carb"><img src="khoailang.png" alt="Khoai"></div>
                <div class="food-item" draggable="true" id="q1-dau" data-target="carb"><img src="daudo.png" alt="ƒê·∫≠u"></div>
                <div class="food-item" draggable="true" id="q1-lua" data-target="carb"><img src="luami.png" alt="L√∫a m√¨"></div>
                <div class="food-item" draggable="true" id="q1-rau" data-target="vitamin"><img src="rau.png" alt="Rau"></div>
                <div class="food-item" draggable="true" id="q1-ca" data-target="protein"><img src="ca.png" alt="C√°"></div>
                <div class="food-item" draggable="true" id="q1-tom" data-target="protein"><img src="tom.png" alt="T√¥m"></div>
            </div>
            <div class="basket-area">
                <div class="basket b-vitamin" data-type="vitamin"></div>
                <div class="basket b-fat" data-type="fat"></div>
                <div class="basket b-carb" data-type="carb"></div>
                <div class="basket b-protein" data-type="protein"></div>
            </div>
            <div class="controls">
                <button class="btn btn-replay" onclick="GameApp.resetLevel('q1')">üîÑ L√†m l·∫°i</button>
                <button class="btn btn-next" id="btn-next-q1" onclick="GameApp.nextLevel('q2')">Ti·∫øp theo ‚û°Ô∏è</button>
            </div>
        </div>

        <div class="screen" id="q2">
            <div class="question-box"><div class="question-title">C√¢u 2: B√© h√£y ch·ªçn c√°c th·ª±c ph·∫©m thu·ªôc nh√≥m <b>CH·∫§T B√âO</b>?</div></div>
            <div class="items-area">
                <div class="food-item" draggable="true" id="q2-phomai" data-target="fat"><img src="phomai.png"></div>
                <div class="food-item" draggable="true" id="q2-bo" data-target="fat"><img src="bo.png"></div>
                <div class="food-item" draggable="true" id="q2-quabo" data-target="fat"><img src="quabo.png"></div>
                <div class="food-item" draggable="true" id="q2-hat" data-target="fat"><img src="hatoccho.png"></div>
                <div class="food-item" draggable="true" id="q2-dauca" data-target="fat"><img src="dauca.png"></div>
                <div class="food-item" draggable="true" id="q2-dauan" data-target="fat"><img src="dauan.png"></div>
                <div class="food-item" draggable="true" id="q2-tom" data-target="protein"><img src="tom.png"></div>
                <div class="food-item" draggable="true" id="q2-ca" data-target="protein"><img src="ca.png"></div>
                <div class="food-item" draggable="true" id="q2-rau" data-target="vitamin"><img src="rau.png"></div>
            </div>
            <div class="basket-area">
                <div class="basket b-vitamin" data-type="vitamin"></div>
                <div class="basket b-fat" data-type="fat"></div>
                <div class="basket b-carb" data-type="carb"></div>
                <div class="basket b-protein" data-type="protein"></div>
            </div>
            <div class="controls">
                <button class="btn btn-replay" onclick="GameApp.resetLevel('q2')">üîÑ L√†m l·∫°i</button>
                <button class="btn btn-next" id="btn-next-q2" onclick="GameApp.nextLevel('q3')">Ti·∫øp theo ‚û°Ô∏è</button>
            </div>
        </div>

        <div class="screen" id="q3">
            <div class="question-box"><div class="question-title">C√¢u 3: B√© h√£y t√¨m nh√≥m th·ª±c ph·∫©m ch·ª©a <b>CH·∫§T ƒê·∫†M</b>?</div></div>
            <div class="items-area">
                <div class="food-item" draggable="true" id="q3-tom" data-target="protein"><img src="tom.png"></div>
                <div class="food-item" draggable="true" id="q3-heo" data-target="protein"><img src="thitheo.png"></div>
                <div class="food-item" draggable="true" id="q3-ga" data-target="protein"><img src="ga.png"></div>
                <div class="food-item" draggable="true" id="q3-trung" data-target="protein"><img src="trung.png"></div>
                <div class="food-item" draggable="true" id="q3-ca" data-target="protein"><img src="ca.png"></div>
                <div class="food-item" draggable="true" id="q3-xalach" data-target="vitamin"><img src="xalach.png"></div>
                <div class="food-item" draggable="true" id="q3-gao" data-target="carb"><img src="gao.png"></div>
                <div class="food-item" draggable="true" id="q3-banhmi" data-target="carb"><img src="banhmi.png"></div>
            </div>
            <div class="basket-area">
                <div class="basket b-vitamin" data-type="vitamin"></div>
                <div class="basket b-fat" data-type="fat"></div>
                <div class="basket b-carb" data-type="carb"></div>
                <div class="basket b-protein" data-type="protein"></div>
            </div>
            <div class="controls">
                <button class="btn btn-replay" onclick="GameApp.resetLevel('q3')">üîÑ L√†m l·∫°i</button>
                <button class="btn btn-next" id="btn-next-q3" onclick="GameApp.nextLevel('q4')">Ti·∫øp theo ‚û°Ô∏è</button>
            </div>
        </div>

        <div class="screen" id="q4">
            <div class="question-box"><div class="question-title">C√¢u 4: B√© h√£y t√¨m th·ª±c ph·∫©m ch·ª©a <b>VITAMIN V√Ä MU·ªêI KHO√ÅNG</b>?</div></div>
            <div class="items-area">
                <div class="food-item" draggable="true" id="q4-raucai" data-target="vitamin"><img src="raucai.png"></div>
                <div class="food-item" draggable="true" id="q4-hat" data-target="vitamin"><img src="hatoccho.png"></div>
                <div class="food-item" draggable="true" id="q4-suachua" data-target="vitamin"><img src="suachua.png"></div>
                <div class="food-item" draggable="true" id="q4-dudu" data-target="vitamin"><img src="dudu.png"></div>
                <div class="food-item" draggable="true" id="q4-ga" data-target="protein"><img src="ga.png"></div>
                <div class="food-item" draggable="true" id="q4-tom" data-target="protein"><img src="tom.png"></div>
                <div class="food-item" draggable="true" id="q4-gao" data-target="carb"><img src="gao.png"></div>
                <div class="food-item" draggable="true" id="q4-banhmi" data-target="carb"><img src="banhmi.png"></div>
            </div>
            <div class="basket-area">
                <div class="basket b-vitamin" data-type="vitamin"></div>
                <div class="basket b-fat" data-type="fat"></div>
                <div class="basket b-carb" data-type="carb"></div>
                <div class="basket b-protein" data-type="protein"></div>
            </div>
            <div class="controls">
                <button class="btn btn-replay" onclick="GameApp.resetLevel('q4')">üîÑ L√†m l·∫°i</button>
                <button class="btn btn-next" id="btn-next-q4" onclick="GameApp.nextLevel('q5')">Ti·∫øp theo ‚û°Ô∏è</button>
            </div>
        </div>

        <div class="screen" id="q5">
            <div class="question-box"><div class="question-title">C√¢u 5: Th·ª±c ph·∫©m ch·ª©a <b>CH·∫§T ƒê·∫†M</b> gi√∫p √≠ch g√¨ cho c∆° th·ªÉ?</div></div>
            <div class="items-area text-mode">
                <div class="food-item" draggable="true" id="q5-dung" data-target="correct"><img src="lonlen.png" alt="L·ªõn l√™n"></div>
                <div class="food-item" draggable="true" id="q5-sai1" data-target="wrong"><img src="nangluong.png" alt="NƒÉng l∆∞·ª£ng"></div>
                <div class="food-item" draggable="true" id="q5-sai2" data-target="wrong"><img src="dekhang.png" alt="ƒê·ªÅ kh√°ng"></div>
                <div class="food-item" draggable="true" id="q5-sai3" data-target="wrong"><img src="hapthu.png" alt="H·∫•p th·ª• Vitamin"></div>
            </div>
            <div class="basket-area">
                <div class="basket big-basket" data-type="correct"></div> 
            </div>
            <div class="controls">
                <button class="btn btn-replay" onclick="GameApp.resetLevel('q5')">üîÑ L√†m l·∫°i</button>
                <button class="btn btn-next" id="btn-next-q5" onclick="GameApp.nextLevel('q6')">Ti·∫øp theo ‚û°Ô∏è</button>
            </div>
        </div>

        <div class="screen" id="q6">
            <div class="question-box"><div class="question-title">C√¢u 6: Th·ª±c ph·∫©m ch·ª©a <b>CH·∫§T B√âO</b> gi√∫p √≠ch g√¨ cho c∆° th·ªÉ?</div></div>
            <div class="items-area text-mode">
                <div class="food-item" draggable="true" id="q6-dung" data-target="correct"><img src="hapthu.png" alt="H·∫•p th·ª• Vitamin"></div>
                <div class="food-item" draggable="true" id="q6-sai1" data-target="wrong"><img src="lonlen.png" alt="L·ªõn l√™n"></div>
                <div class="food-item" draggable="true" id="q6-sai2" data-target="wrong"><img src="dekhang.png" alt="ƒê·ªÅ kh√°ng"></div>
                <div class="food-item" draggable="true" id="q6-sai3" data-target="wrong"><img src="nangluong.png" alt="NƒÉng l∆∞·ª£ng"></div>
            </div>
            <div class="basket-area">
                <div class="basket big-basket" data-type="correct"></div> 
            </div>
            <div class="controls">
                <button class="btn btn-replay" onclick="GameApp.resetLevel('q6')">üîÑ L√†m l·∫°i</button>
                <button class="btn btn-next" id="btn-next-q6" onclick="GameApp.showVictory()">V·ªÅ ƒê√≠ch üèÅ</button>
            </div>
        </div>

        <div id="victory-screen">
            <h1 style="font-size: 5vh; color: #d63031;">üéâ B√â GI·ªéI QU√Å! üéâ</h1>
            <p style="font-size: 3vh;">B√© ƒë√£ tr·∫£ l·ªùi ƒë√∫ng h·∫øt 6 c√¢u h·ªèi.</p>
            <button class="btn btn-start" style="margin-top: 3vh; position: static; border: 2px solid #00b894; box-shadow: none;" onclick="location.reload()">CH∆†I L·∫†I T·ª™ ƒê·∫¶U</button>
        </div>

    </div> <script>
        /**
         * GAME MODULE
         * S·ª≠ d·ª•ng m·∫´u thi·∫øt k·∫ø Module Pattern ƒë·ªÉ ƒë√≥ng g√≥i logic, tr√°nh √¥ nhi·ªÖm bi·∫øn to√†n c·ª•c.
         */
        const GameApp = (() => {
            // C·∫•u h√¨nh s·ªë ƒë√°p √°n ƒë√∫ng cho m·ªói m√†n
            const levelConfig = {
                'q1': 7, 'q2': 9, 'q3': 5, 'q4': 4, 'q5': 1, 'q6': 1
            };

            // Tr·∫°ng th√°i game hi·ªán t·∫°i
            let state = {
                currentCorrect: 0,
                touchItem: null,
                touchOffsetX: 0,
                touchOffsetY: 0
            };

            // Cache DOM elements
            const dom = {
                music: document.getElementById('bg-music'),
                wrongSound: document.getElementById('sound-wrong'),
                correctSound: document.getElementById('sound-correct'),
                startScreen: document.getElementById('start-screen'),
                victoryScreen: document.getElementById('victory-screen'),
                screens: document.querySelectorAll('.screen')
            };

            // --- C√ÅC H√ÄM X·ª¨ L√ù LOGIC CH√çNH ---

            const start = () => {
                // Hi·ªáu ·ª©ng m·ªù d·∫ßn m√†n h√¨nh intro
                dom.startScreen.style.opacity = '0';
                setTimeout(() => dom.startScreen.style.display = 'none', 500);
                document.getElementById('q1').classList.add('active-screen');
                dom.music.volume = 0.3;
                dom.music.play().catch(() => console.log("C·∫ßn t∆∞∆°ng t√°c ƒë·ªÉ ph√°t nh·∫°c"));
            };

            const nextLevel = (nextId) => {
                dom.screens.forEach(s => s.classList.remove('active-screen'));
                if(nextId === 'victory') {
                    showVictory();
                } else {
                    document.getElementById(nextId).classList.add('active-screen');
                    state.currentCorrect = 0;
                }
            };

            const resetLevel = (screenId) => {
                const screen = document.getElementById(screenId);
                screen.querySelector('.btn-next').style.display = 'none';
                screen.querySelectorAll('.food-item').forEach(item => {
                    item.style.display = 'flex';
                    item.classList.remove('hidden');
                    item.style.position = 'static';
                    item.style.transform = 'none';
                });
                state.currentCorrect = 0;
            };

            const showVictory = () => {
                dom.screens.forEach(s => s.classList.remove('active-screen'));
                dom.victoryScreen.style.display = 'flex';
                // T·∫°o hi·ªáu ·ª©ng ph√°o hoa ƒë∆°n gi·∫£n
                createConfetti(dom.victoryScreen);
            };

            const playSound = (type) => {
                const audio = type === 'correct' ? dom.correctSound : dom.wrongSound;
                audio.currentTime = 0;
                audio.play().catch(e => {});
            };

            // --- X·ª¨ L√ù LOGIC K√âO TH·∫¢ (DRAG & DROP) ---

            const checkResult = (item, basket) => {
                const itemTarget = item.getAttribute('data-target');
                const basketType = basket.getAttribute('data-type');
                const currentScreenId = item.closest('.screen').id;
                const requiredCount = levelConfig[currentScreenId];

                if (itemTarget === basketType) {
                    // ƒê√öNG
                    playSound('correct');
                    item.style.display = 'none'; // ·∫®n v·∫≠t ph·∫©m
                    
                    // Hi·ªáu ·ª©ng ng√¥i sao bay l√™n
                    showFeedback(basket, '‚≠ê');
                    
                    state.currentCorrect++;
                    
                    // Ki·ªÉm tra ho√†n th√†nh m√†n ch∆°i
                    if (state.currentCorrect >= requiredCount) {
                        const btnNext = document.getElementById('btn-next-' + currentScreenId);
                        if(btnNext) {
                            btnNext.style.display = 'block';
                            createConfetti(document.getElementById(currentScreenId));
                        }
                    }
                } else {
                    // SAI
                    playSound('wrong');
                    basket.classList.add('shake');
                    setTimeout(() => basket.classList.remove('shake'), 500);
                    
                    // Tr·∫£ v·∫≠t ph·∫©m v·ªÅ ch·ªó c≈©
                    item.classList.remove('hidden');
                    item.style.position = 'static';
                    item.style.transform = 'none';
                }
            };

            const showFeedback = (container, icon) => {
                const el = document.createElement('div');
                el.textContent = icon;
                el.style.cssText = `position: absolute; left: 40%; top: 50%; font-size: 40px; animation: fadeUp 1s forwards; pointer-events: none;`;
                const style = document.createElement('style');
                style.innerHTML = `@keyframes fadeUp { 0% { opacity:1; transform:translateY(0); } 100% { opacity:0; transform:translateY(-50px); } }`;
                document.head.appendChild(style);
                container.appendChild(el);
                setTimeout(() => el.remove(), 1000);
            };

            const createConfetti = (container) => {
                for(let i=0; i<30; i++) {
                    const conf = document.createElement('div');
                    conf.style.cssText = `
                        position: absolute; width: 10px; height: 10px;
                        background: ${['#ff7675', '#fdcb6e', '#00b894', '#0984e3'][Math.floor(Math.random()*4)]};
                        left: ${Math.random() * 100}%; top: -10px; z-index: 5;
                        transition: top ${1 + Math.random()}s ease-out;
                    `;
                    container.appendChild(conf);
                    setTimeout(() => conf.style.top = '110%', 100);
                    setTimeout(() => conf.remove(), 2000);
                }
            };

            // --- S·ª∞ KI·ªÜN MOUSE/TOUCH ---

            const initEvents = () => {
                const items = document.querySelectorAll('.food-item');
                const baskets = document.querySelectorAll('.basket');

                // Desktop Drag Events
                items.forEach(item => {
                    item.addEventListener('dragstart', (e) => {
                        e.dataTransfer.setData('text/id', e.target.id);
                        setTimeout(() => e.target.classList.add('hidden'), 0);
                    });
                    item.addEventListener('dragend', (e) => {
                         e.target.classList.remove('hidden');
                    });
                });

                baskets.forEach(basket => {
                    basket.addEventListener('dragover', e => { e.preventDefault(); basket.classList.add('hovered'); });
                    basket.addEventListener('dragleave', e => { basket.classList.remove('hovered'); });
                    basket.addEventListener('drop', e => {
                        e.preventDefault();
                        basket.classList.remove('hovered');
                        const id = e.dataTransfer.getData('text/id');
                        const item = document.getElementById(id);
                        if(item) checkResult(item, basket);
                    });
                });

                // Mobile Touch Events (Custom Logic)
                items.forEach(item => {
                    item.addEventListener('touchstart', (e) => {
                        state.touchItem = item;
                        const touch = e.touches[0];
                        // T√≠nh to√°n offset ƒë·ªÉ ng√≥n tay kh√¥ng che m·∫•t v·∫≠t ph·∫©m
                        const rect = item.getBoundingClientRect();
                        state.touchOffsetX = touch.clientX - rect.left;
                        state.touchOffsetY = touch.clientY - rect.top;
                        item.style.position = 'fixed';
                        item.style.zIndex = 1000;
                    }, {passive: false});

                    item.addEventListener('touchmove', (e) => {
                        if (!state.touchItem) return;
                        e.preventDefault(); // NgƒÉn cu·ªôn m√†n h√¨nh
                        const touch = e.touches[0];
                        state.touchItem.style.left = (touch.clientX - state.touchOffsetX) + 'px';
                        state.touchItem.style.top = (touch.clientY - state.touchOffsetY) + 'px';
                    }, {passive: false});

                    item.addEventListener('touchend', (e) => {
                        if (!state.touchItem) return;
                        
                        // ·∫®n t·∫°m th·ªùi ƒë·ªÉ t√¨m element b√™n d∆∞·ªõi
                        state.touchItem.style.display = 'none';
                        const touch = e.changedTouches[0];
                        const elemBelow = document.elementFromPoint(touch.clientX, touch.clientY);
                        state.touchItem.style.display = 'flex'; // Hi·ªán l·∫°i

                        const basket = elemBelow ? elemBelow.closest('.basket') : null;
                        
                        if (basket) {
                            checkResult(state.touchItem, basket);
                        } else {
                            // Reset v·ªÅ v·ªã tr√≠ c≈© n·∫øu kh√¥ng th·∫£ v√†o gi·ªè
                            state.touchItem.style.position = 'static';
                            state.touchItem.style.transform = 'none';
                            playSound('wrong');
                        }
                        state.touchItem = null;
                    });
                });
            };

            // Kh·ªüi t·∫°o ngay khi t·∫£i xong
            return {
                init: initEvents,
                start: start,
                nextLevel: nextLevel,
                resetLevel: resetLevel,
                showVictory: showVictory
            };
        })();

        // Ch·∫°y game
        document.addEventListener('DOMContentLoaded', GameApp.init);
    </script>
</body>
</html>